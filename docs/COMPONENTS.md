# Veil — Components Map

This document provides a concise map of the main components in the Veil repository and their responsibilities. Use this as a starting point for refactors, integration, and docs work required by the ROADMAP.

**Codex (Core knowledge graph):**
- Location: `pkg/codex/` and `cmd/codex/`
- Responsibility: Implements the knowledge graph, export/import, and storage abstractions used to store nodes, versions, and branches. Key files: `pkg/codex/codex.go`, `pkg/codex/export.go`, `pkg/codex/storage/fs`.

**Core Storage:**
- Location: `pkg/core/`
- Responsibility: Storage backends and helpers (filesystem-backed storage). Key files: `pkg/core/core.go`, `pkg/core/fs_storage.go`, `pkg/core/README.md`.

**Plugins:**
- Location: `pkg/plugins/` and top-level `plugins.go` / `plugins` packages
- Responsibility: Pluggable adapters that extend Veil (Git, IPFS, media, reminders, todos, namecheap, shaders, etc.). Key files: `pkg/plugins/plugins_api.go`, `pkg/plugins/git_plugin.go`, `pkg/plugins/ipfs_plugin.go`, `pkg/plugins/media_plugin.go`, `pkg/plugins/reminder_plugin.go`, `pkg/plugins/todo_plugin.go`.

**CLI / Commands:**
- Location: `cmd/codex/` and top-level CLI handlers
- Responsibility: Command-line interface for interacting with a codex repository: `init`, `add`, `commit`, `push`, `server`, `status`, `annotate`, `entity`, `gui`. Key files: `cmd/codex/*.go`, `cmd/codex/repo.go`.

**Server & Web UI:**
- Location: `web/` and `cmd/codex/static/`
- Responsibility: Web frontend and static assets for presenting and interacting with codex data; includes client code and single-page app assets. Key files: `web/*`, `cmd/codex/static/*` and web codex app in `web/codex`.

**Top-level application:**
- Location: root (`main.go`, `handlers.go`, `plugins.go`, `export.go`, etc.)
- Responsibility: Entrypoints, high-level orchestration, HTTP handlers, and glue code connecting codex, plugins, and CLI.

**Migrations & DB:**
- Location: `migrations/`
- Responsibility: SQL migration files and schema definitions for any persistent storage.

**Docs & Roadmap:**
- Location: `docs/`, `ROADMAP`, `README.md` and `docs/*.md`
- Responsibility: Architecture docs and contributor guides.

**Tests:**
- Location: `*_test.go` across packages and `pkg/` tests
- Responsibility: Unit and integration tests for codex, plugins, and storage backends.

## Notes / Next steps
- Use this document as the authoritative mapping when implementing the ROADMAP items.
- Next action: audit each package's public API and generate `docs/ARCHITECTURE.md` describing the unified architecture with interfaces that make `codex` the single source of truth.
# Veil Components Audit

This document summarizes the responsibilities and high-level notes for the main components discovered in the codebase. Use this as the starting point for refactors and integration work.

## Summary
- Main CLI / server entrypoint: `main.go` — wires up web UI, server routes, plugin initialization, and CLI commands.
- Codex (knowledge graph): `pkg/codex` (plus `cmd/codex`) — repository implementation, commits, objects, storage backends.
- Plugin layer: `pkg/plugins` and top-level `plugins/` implementations — Git, IPFS, media, namecheap, pixospritz, etc.
- Core app APIs & handlers: `codex_api.go`, `handlers.go`, `export.go`, etc. — node CRUD, publishing, media, search, etc.
- Web UI: `web/` and `codex-universalis/` static UIs — frontend assets and prototype Codex UI.
- CLI helpers: `cmd/` (codex commands) — local repository commands.
- Storage & migration: `migrations/`, `pkg/core` and `pkg/codex/storage/fs` — DB migrations and file-based codex storage.

## Noted overlaps / issues
- There is duplication between `pkg/core` and `pkg/codex` packages (both expose Repository/FS storage patterns). Decide on single canonical package (pref: `pkg/codex`) and migrate shared references.
- Plugins are implemented in both `pkg/plugins` and top-level `plugins/` directories; unify into `pkg/plugins` and de-duplicate registry initialization.
- HTTP handler responsibilities are spread across `main.go` and `codex_api.go` and other files; consolidate route registration and handler testing.
- Codex storage currently assumes JSON files under `.codex/objects` and small-scale use; needs design for binary/chunked objects and streaming.

## Next steps (short term)
1. Decide canonical codex/core package and add a migration plan for symbols.
2. Define a single `plugins.Plugin` interface and refactor existing plugins to match it.
3. Centralize API handler registration into `server/` or `api/` package and add tests.
4. Implement a storage interface for large objects with streaming and chunking.

---

*Generated by audit on `main` branch.*
